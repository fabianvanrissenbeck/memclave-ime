# In-Memory Enclaves

## Hardware Additions

We add two features to a DPU that aren't present on current editions:
1. CI lockdown - After bootup a DPU does no longer communicate over a CI
   + Already implemented in the Bachelor's project
2. MUX switch - DPUs can explicitly set the MUX state - The host is not
   allowed to switch the MUX anymore. The host can query the MUX state.

## General Kernel Structure

The kernel of the in-memory enclave will be seperated into two
different section with different levels of trust. The core section
remains on the DPU during its entire lifetime, while the subkernel
section can be switched out at runtime and can be provided by
the user.

### Core Section

The core section's purpose it to load and verify code generated by a trusted
party before the DPU's boot phase. The core loader is equipped with a
hardcoded key and an implementation for Chacha20-Poly1305. Using this,
the core can verify MAC's generated during the trusted boot process,
including those of trusted sections. Additionally, trusted sections are
allowed to contain secrets, because they can remain encrypted in MRAM.

### Subkernel

A subkernel is very similar to a normal UPMEM kernel, but is loaded by
the core loader instead. Subkernels are subject to a slighly different
memory layout (mostly handled by a linker script) and may not use
every instruction. They can be created using UPMEM's SDK. 

